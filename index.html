<!DOCTYPE HTML>
<html>
<head>
<link rel="stylesheet" href="css/materialize.min.css">
    <style>
       	#splash-screen {
		width: 100%;
		height: 100%;
		position: absolute;
		z-index: 999;
		overflow: hidden;
	}
	.clock {
		display: none;
	}
	#splash-screen-content {
		position: absolute;
		width: 100%;
		height: 100%;
		top: 0;
	}
	.splash-screen-img {
/*		height: 100%;
		width: 100%; */
		/* border: 8px solid red; */
	}
	.filter{
		filter: blur(15px) contrast(127%) brightness(80%);
	}
	.vignette {
		width: 100%;
		height: 100%;
		position: absolute;
		top: 0;
		box-shadow: inset 0 0 100px black;
		z-index: 2;
	}
	 body {
		      display: flex;
		           min-height: 100vh;
			        flex-direction: column;
              background-color: white;
				 }
	  main {
		       flex: 1 0 auto;
    }

    div#console {
      z-index: 9999;
      position: absolute;
      top: 4px;
    }
    #console textarea {
      overflow-y: scroll;
      background-color: rgba(0,0,0,0.8);
      font-size: 16pt;
      color: white;
      height: 30vh;
      width: 85vw;
    }

    </style>
</head>
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/moment-with-locales.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/materialize.min.js"></script>
<!-- <script src="js/lightdm-sample.js"></script> -->
<script src="js/theme.js"></script>

<body>

    <div id="console" class="row">
        <div class="col">
          <div class="switch">
            <label>
              <input type="checkbox">
              <span class="lever"></span>
              Auto
            </label>
          </div>
        </div>
        <div class="col">
          <textarea rows="10" readonly="true"></textarea>
        </div>


    </div>

  <div id="splash-screen">
    <!--TODO autogenerate this content -->
    <img class="splash-screen-img" src="images/splash-screen.jpg">
    <div class="vignette"></div>
    <div id="splash-screen-content">
      <!--Content will be generated here -->
    </div>
  </div>

  <header></header>
	<main>
		<div class="container">
      <div class="row" style="margin-top: 35vh;"></div>
			<div class="row ">
				<!-- User Select -->
				<div class="row">
					<div class="input-field col s4 offset-s4">
						<select id="selectUser"></select>
						<label>User</label>
					</div>
				</div>

				<!-- Password field -->
				<div class="row">
					<div class="input-field col s4 offset-s4">
						<input id="inputPassword" type="password" class="validate">
						<label for="inputPassword">Password</label>
					</div>
				</div>
        <!-- End Password field -->

      </div>
		</div>


	</main>


  <footer class="">

    <div class="row">

      <!-- Window Manager Select -->
      <div class="input-field col s2 offset-s1">
        <select id="selectSession"></select>
        <label>Select Session</label>
      </div>
      <!-- End Window Manager Select -->

      <!-- Power Button -->
      <div class="col offset-s8">
          <img class="right" src="images/power.svg" width="40px" height="40px">
      </div>
      <!-- End Power Button -->

    </div>
  </footer>
<script>



// create singleton
const greeter = new LoginManager();

// called after greeter and lightdm are initialized
$(greeter).ready(function() {
  let $user = $("#selectUser");
  let $session = $("#selectSession");
  let $password = $("#inputPassword");

  greeter.fillUserSelect($user);
  greeter.fillSessionSelect($session);

  // $("#debug").text(JSON.stringify(greeter.lightdm,null, 2));
  $password.keypress((e) => {
    let username = $user.children("option:selected").val();
    let pass = $password.val();

    /* attempt authentication, 'grant' event will be emitted on sucecss
    and 'deny' will be emitted on failure */
    if (e.keyCode == 13)
    	greeter.auth(username, pass);
  });

  // when the user is authenticated do transitions and login
	$(greeter).on("grant", () => {
    let session_key = $session.children("option:selected").val();
    greeter.login(session_key);
	})
  .on("deny", () => {
    // inform the user that the credentials are invalid
    $password.addClass("invalid");
  });

	$(greeter.splash).on("active", function() {
		$(".active-appear").fadeIn();
	}).on("inactive", function() {
		$(".active-appear").fadeOut();
	});
});


</script>
<script>
  /*
	 * Define this fuction so lightdm doesnt crash, gets resassigned
   * in login manager
	 */
	window.authentication_complete = function() {

	};


</script>
</body>
</html>
