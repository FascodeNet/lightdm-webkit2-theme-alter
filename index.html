<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
<head>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            opacity: 1;
            margin: 0;
            background-color: #ffffff;
            transition: opacity 2s, background-color 2s, background-position 2s;
            transition-timing-function: ease-in;
        }

        body {
            background: linear-gradient(transparent, SlateGray);
            background-color: #ffffff;
            font-family: 'sans-serif';
            font-size: 24px;
        }

        html.session_starting {
            opacity: 0;
        }

        .session_starting body {
            opacity: 0;
            background-color: rgba(0, 0, 0, 0);
            background-position-y: -100%;
        }

        .container {
            width: 100%;
            height: 100%;
            display: -webkit-flex;
            display: flex;
            -webkit-flex-direction: column;
            flex-direction: column;
        }

        .topBox, .inputBox, .messageBox {
            width: 100%;
            height: 33.33%;
            text-align: center;
        }

        .inputBox {
            position: relative;
        }

        .wrapper {
            height: 85px;
            width: 350px;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
        }

        .topBox {
            text-align: right;
            padding: 15px;
            box-sizing: border-box;
        }

        .messageBox {
            text-align: center;
            visibility: hidden;
        }

        input#entry {
            outline: none;
            background: rgba(0, 0, 0, 0.05);
            box-shadow: none;
            box-sizing: border-box;
            line-height: normal;
            transition: .3s ease;
            border: none !important;
            padding: 14px 4% !important;
            font-size: 16px;
            color: #666;
            background-color: #fff;
            width: 100%;
            font-weight: 400;
            border-radius: 3px !important;
        }

        input#entry:focus {
            background: rgba(0, 0, 0, 0.1);
            color: rgba(0, 0, 0, 0.75);
        }

        input#entry:focus::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }
	#splash-screen {
		width: 100%;
		height: 100%;
		position: absolute;
		z-index: 999;
	}
	#clock {
		margin-top: 200pt; 
		color: white;
		text-align: center;
		font-size: 60pt;
		font-family: "Noto Sans";
	}
	.splash-screen-text {
		position: relative;
		top: -100%;
	}
	.splash-screen-img {
/*		height: 100%;
		width: 100%;*/:
		border: 8px solid red;
	}
	.blur {
		filter: blur(1px);
	}
	.vignette {
		width: 100%;
		position:relative;
		top: 0;
		height: 100%;
		box-shadow: inset 0 0 100px black;
	}
    </style>
</head>
<script src="js/jquery-3.4.1.min.js"></script>
<script>
var adjustBackground = function() {
	var $viewport = $(window);
	var $img = $(".splash-screen-img");
	var viewportWidth = screen.width;
	var viewportHeight = screen.height;
	var viewportAspect = viewportWidth/viewportHeight;
	var imgWidth = $img.width();
	var imgHeight = $img.height();
	var imgAspect = imgWidth/imgHeight; 
	console.log(imgAspect);	
	// If the image is larger than the screen, scale it down until it's 
	// just larger than viewport. Then center it.
	if (imgWidth > viewportWidth && imgHeight > viewportHeight) {
		// determine what set of dimensions are the limiting factor (ie. smaller)
		if (imgAspect < viewportAspect) {
			// The view port is wider compared to its height than the image is
			// meaning the width is the limiting dimension.
			// Therefore we set image width = view ports width
			// use the aspect ratio to set the correct height
			console.log("viewport is wider than image");
			console.log("setting width to: " + viewportWidth);
			console.log("setting height to: " + imgAspect*viewportWidth);
			$img.width(viewportWidth);
			$img.height(imgAspect*viewportWidth);
		} else {
			// The image is more wide than it is tall compared to the viewport so we adjust the height
			// to fit
			console.log("image is wider than viewport");
			console.log("setting width to: " + viewportHeight*imgAspect);
			console.log("setting height to: " + viewportHeight);
			$img.height(viewportHeight);
			$img.width(viewportHeight*imgAspect);
		}
		centerImage($img);
	}
	// if the image is too small, perseve the aspect ratio and scale up
	// once both the height and the width are large enough, center the image
}
var centerImage = function($img) {
	var overlapWidth = $img.width() - screen.width;
	var overlapHeight = $img.height() - screen.height;

	// image overlaps viewport, move the image back 
	// half the length of the overlap
	$img.css({
		position: "relative",
		right: overlapWidth/2,
		bottom: overlapHeight/2 
	}); 

}
</script>
<body id="body">
<div class="container">
	<div id="splash-screen">
		<img class="splash-screen-img blur" src="images/splash-screen.jpg"> 
		<div class="vignette"></div>
		<div class="splash-screen-text">
			<div id="clock">12:48</div>	
		</div>
	</div>
    <div class="topBox">
	<img onclick="javascript:lightdm.shutdown();" src="power_button.png"/>
    </div>
    <div class="inputBox">
        <div class="wrapper">
            <div id="prompt"></div>
            <form action="javascript:handle_input();">
                <input id="entry" />
            </form>
        </div>
    </div>
    <div class="messageBox" id="messages"></div>
</div>
<script>
    /*********************************************************/
    /*               Callbacks for the greeter               */
    /*********************************************************/

    /**
     * show_prompt callback.
     */
    window.show_prompt = function(text, type) {
	// type is either "text" or "password"
        let prompt = document.getElementById("prompt"),
            entry = document.getElementById("entry");

        entry.placeholder = text.charAt(0).toUpperCase() + text.slice(1, -1);

        // clear entry
        entry.value = "";
        entry.type = type;
    };

    /**
     * show_message callback.
     */
    window.show_message = function(text, type) {
        if (0 === text.length) {
            return;
        }
        let messages = document.getElementById('messages');
        messages.style.visibility = "visible";
        // type is either "info" or "error"
        if (type == 'error') {
            text = `<p style="color:red;">${text}</p>`;
        }
        messages.innerHTML = `${messages.innerHTML}${text}`;
    };

    /**
     * authentication_complete callback.
     */
 var   ac = function(session_key) {
        if (lightdm.is_authenticated) {
            // Start default session
            document.documentElement.addEventListener('transitionend', () => lightdm.start_session_sync(session_key));
            document.documentElement.className = 'session_starting';
        } else {
            window.show_message("Authentication Failed", "error");
            setTimeout(window.start_authentication, 3000);
        }
    };

    /**
     * autologin_timer_expired callback.
     */
    function autologin_timer_expired(username) {
        /* Stub.  Does nothing. */
    }

    /*******************************************************************/
    /*                Functions local to this theme                    */
    /*******************************************************************/

    /**
     * clear_messages
     */
    function clear_messages() {
        let messages = document.getElementById("messages");
        messages.innerHTML = "";
        messages.style.visibility = "hidden";
    }

    /**
     * Kickoff the authentication process
     */
    window.start_authentication = function() {
        clear_messages();
        // start without providing "user" to make the greeter prompt for "user"
        lightdm.authenticate();
    };

    /**
     * handle the input from the entry field.
     */
    window.handle_input = function() {
    //  let entry = document.getElementById("entry");
    //  lightdm.respond(entry.value);
    };

    function login(username, password, callback) {
        // set default values
        username = username || lightdm.select_user; 
        password = password || "";
        //  session_key = session_key || lightdm.sessions[0].key;

       var auth_cb = function() {
            lightdm.respond(password);
        }
       var auth_complete_cb = function() {
            if (typeof callback == "function")
                callback(lightdm.is_authenticated);
        }
        window.show_prompt = auth_cb; 
        window.authentication_complete = auth_complete_cb; 


        lightdm.authenticate(username);
            

    }
 
    //TODO: make sure that lightdm is not referenced until pages has finished loading
    setTimeout(() => login("jay", "", () => {
        for(var x = 0; x < lightdm.sessions.length; x++){
       window.show_message(lightdm.sessions[x].key, "info");
    } 
    ac("i3");           
    }) , 10);
</script>
</body>
</html>
